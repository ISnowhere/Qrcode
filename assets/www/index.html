<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="css/jquery.mobile-1.3.2.min.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.mobile-1.3.2.min.js"></script>
    <script src="js/qr.js"></script>
      <script src="phonegap-2.9.0.js" type="text/javascript"></script>
<script src="barcodescanner.js" type="text/javascript"></script>
<script type="text/javascript">
var scanCode = function() {
    window.plugins.barcodeScanner.scan(
        function(result) {
        	
        	location.hash="#pagethree";  
        	//判断得到的内容是不是网页
        	var first= result.text.indexOf("http");
        	if(first == 0){
        		$("#p_span").html(result.text);
        		$("#a_span").attr("style","visibility:visible");
        		$("#a_span").attr("href",result.text);
        		
        	}else{
        		$("#p_span").html(result.text);
        	}
        	
        	
        	$("#p_span").html(result.text);
       /*  alert("Scanned Code: " + result.text 
                + ". Format: " + result.format
                + ". Cancelled: " + result.cancelled); */
    }, function(error) {
        alert("Scan failed: " + error);
    });
} 

</script>
  
  
</head>
<body>
<div data-role="page" id="pageone">
<div data-role="header">
    <h1>首页</h1>
</div>
<div data-role="content">
    <p>i am  a student</p>
    <p><a href="#pagetwo" data-transition="flow">生成二维码</a></p>
    <p><a onclick="scanCode()" data-transition="flow">识别二维码</a></p>
    <p><a href="#pagethree" data-transition="flow">识别二维码</a></p>
</div>
    <div data-role="footer" data-position="fixed">
        <h1>版权所有</h1>
    </div>
</div>


<div data-role="page" id="pagetwo">
    <div data-role="header">
        <a href="#pageone" data-transition="flow" data-icon="back" data-direction="reverse" data-role="button">返回</a>
        <h1>生成二维码</h1>
        <a href="#" data-role="button" data-transition="flow" data-icon="plus">分享</a>
    </div>
    <div data-role="content">
        <input id="input" type="text" style="margin-left:50px">
        <button onclick="generateQRCode()" value="生成二维码"></button>
        <br>
        <div id ="message"></div>
        <div align="center">
        <canvas id="qr-canvas" width="300" height="300"></canvas>
        </div>

        <script>
           	QR.canvas = document.getElementById('qr-canvas')


            QR.size = 300

            var input = document.getElementById('input')
           

            function generateQRCode() {

                if (input.value =="") {
                    $('#message').html("<font color='red'>输点内容吧!</font>");
                    return;
                }
                QR.draw(utf16to8(input.value))

            }
           	//生成图片
           	var strDataURI = QR.canvas.toDataURL()
           	
            //汉字支持
            function utf16to8(str) {
                var out, i, len, c;
                out = "";
                len = str.length;
                for (i = 0; i < len; i++) {
                    c = str.charCodeAt(i);
                    if ((c >= 0x0001) && (c <= 0x007F)) {
                        out += str.charAt(i);
                    } else if (c > 0x07FF) {
                        out += String.fromCharCode(0xE0 | ((c >> 12) & 0x0F));
                        out += String.fromCharCode(0x80 | ((c >> 6) & 0x3F));
                        out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));
                    } else {
                        out += String.fromCharCode(0xC0 | ((c >> 6) & 0x1F));
                        out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));
                    }
                }
                return out;
            }
        </script>
    </div>
    <div data-role="footer" data-position="fixed">
        <h1>版权所有</h1>
    </div>
</div>



<div data-role="page" id="pagethree">
    <div data-role="header">
        <a href="#pageone" data-transition="flow" data-icon="back" data-direction="reverse" data-role="button">返回</a>
        <h1>识别二维码</h1>
        <a href="#" data-role="button" data-transition="flow" data-icon="plus">本地图片</a>
    </div>
  <div data-role="content" >
  
  
  

<p> "扫描内容: "<span id="p_span"></span><br><a id="a_span" style="visibility:hidden" href="#">跳转</a></p>
  
  
  
  
  
  
  
  </div>
    <div data-role="footer" data-position="fixed">
        <h1>版权所有</h1>
    </div>
</div>

</body>
</html>